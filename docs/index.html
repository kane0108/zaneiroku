<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BlazorApp</title>

    <script>
        const isLocal =
            location.hostname === "localhost" ||
            location.hostname === "127.0.0.1" ||
            location.origin.startsWith("http://localhost") ||
            location.origin.startsWith("https://localhost");

        if ('serviceWorker' in navigator && !isLocal) {
            navigator.serviceWorker.register(`${document.baseURI}service-worker.js`);
        }
    </script>
</head>

<body>
    <div id="app">Loading...</div>

    <!-- ★ game.js（先に読み込む） -->
    <script src="js/game.js?v=1"></script>

    <!-- ★ Blazor WASM（後で読み込む） -->
    <script src="_framework/blazor.webassembly.js"></script>

    <!-- 復帰イベント -->
    <script>
        document.addEventListener("visibilitychange", () => {
            if (!document.hidden) {
                const nav = performance.getEntriesByType("navigation")[0];
                if (nav && nav.type === "back_forward") location.reload();
            }
        });
        window.addEventListener("pageshow", e => {
            if (e.persisted) location.reload();
        });
    </script>

    <!-- ★★ JS死活監視 ★★ -->
    <script>
        let lastAliveTime = performance.now();
        window.reportAlive = function () {
            lastAliveTime = performance.now();
        };
        setInterval(() => {
            if (performance.now() - lastAliveTime > 3000) {
                console.warn("Frozen → reload");
                location.reload();
            }
        }, 1000);
    </script>

</body>
</html>
